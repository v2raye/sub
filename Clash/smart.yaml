port: 7890
socks-port: 7891
mixed-port: 7892

#############################################
# è¿è¡ŒåŸºçº¿
#############################################
mode: rule                      # åˆ†æµæ¨¡å¼ï¼šrule / global / direct
log-level: info                 # æ—¥å¿—ï¼šsilent/error/warning/info/debug
ipv6: true                      # æ€»å¼€å…³ï¼ˆå…³é—­ä¼šå±è”½ AAAAï¼‰
allow-lan: true                 # å…è®¸å±€åŸŸç½‘è®¾å¤‡è¿æ¥ï¼ˆå…±äº«ç»™æ‰‹æœºå¿…é¡»å¼€å¯ï¼‰
bind-address: "*"               # allow-lan=true æ—¶ï¼Œ"*" ç­‰åŒ 0.0.0.0
unified-delay: true             # å¹¶å‘æµ‹é€Ÿå–æœ€å…ˆè¿”å›
tcp-concurrent: true            # TCP å¹¶å‘æ¡æ‰‹
find-process-mode: strict       # ä¸¥æ ¼åŒ¹é…è¿›ç¨‹ï¼ˆWindows å®¢æˆ·ç«¯æ¨èï¼‰
global-client-fingerprint: chrome  # å…¨å±€ TLS æŒ‡çº¹ï¼ˆèŠ‚ç‚¹å†…å¯å•ç‹¬è¦†ç›–ï¼‰

profile:
  store-selected: true
  store-fake-ip: true
sniffer:
  enable: true
  override-destination: false
  force-dns-mapping: true
  parse-pure-ip: true  
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  skip-domain:
    - "Mijia Cloud"
    - "+.push.apple.com"
hosts:
   dns.alidns.com: [223.5.5.5,223.6.6.6,2400:3200::1,2400:3200:baba::1]
   dns.google: [8.8.8.8,8.8.4.4,2001:4860:4860::8888,2001:4860:4860::8844]
   dns11.quad9.net: [9.9.9.11,149.112.112.11,2620:fe::11,2620:fe::fe:11]
   security.cloudflare-dns.com: [1.1.1.2,1.0.0.2,2606:4700:4700::1112,2606:4700:4700::1002]
tun:
  enable: true
  stack: system
  device: Meta
  dns-hijack:
    - "any:53"
    - "tcp://any:53"
  auto-route: true
  auto-detect-interface: true
  strict-route: true
dns:
  enable: true
  ipv6: true
  respect-rules: true
  enhanced-mode: fake-ip
  fake-ip-filter:
      # é™æ€åŸŸåè§„åˆ™
    - '*.lan'
    - '*.local'
    - '*.localdomain'
    - '*.arpa'
    - 'stun.*.*'
    - 'stun.*.*.*'
    - 'time.*'
    - 'ntp.*'
    # å¼•ç”¨ RuleSet
#    - 'rule-set:CN_domain'
    - 'rule-set:Private_domain'
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
    - 2400:3200::1
  nameserver:
    - https://dns.alidns.com/dns-query
    - https://dns.google/dns-query
    - https://dns11.quad9.net/dns-query
    - https://security.cloudflare-dns.com/dns-query
  proxy-server-nameserver:
    - https://dns.alidns.com/dns-query
    - https://dns.google/dns-query
    - https://dns11.quad9.net/dns-query
    - https://security.cloudflare-dns.com/dns-query
#  nameserver-policy:
#    'rule-set:CN_domain':
#      - https://dns.alidns.com/dns-query
#    'rule-set:Private_domain':
#      - https://dns.alidns.com/dnys-quer
#    'rule-set:OpenAI':
#      - https://dns.google/dns-query
#      - https://dns11.quad9.net/dns-query
#      - https://security.cloudflare-dns.com/dns-query
#    'rule-set:Proxy':
#      - https://dns.google/dns-query
#      - https://dns11.quad9.net/dns-query
 #     - https://security.cloudflare-dns.com/dns-query
# é”šç‚¹ - èŠ‚ç‚¹è®¢é˜…çš„å‚æ•° [æ¯å°æ—¶æ›´æ–°ä¸€æ¬¡è®¢é˜…èŠ‚ç‚¹ï¼Œæ¯ 6 ç§’ä¸€æ¬¡å¥åº·æ£€æŸ¥]
NodeParam: &NodeParam {type: http, interval: 86400, health-check: {enable: true, url: 'http://captive.apple.com/generate_204', interval: 1800}}

# é”šç‚¹ - èŠ‚ç‚¹è®¢é˜…
proxy-providers: 
  Clash_Meta:
    url: ''
    <<: *NodeParam
    path: './proxy_providers/Clash_Meta.yaml'
# é”šç‚¹ - èŠ‚ç‚¹ç­›é€‰ç»„
FilterEM: &FilterEM '(?i)(ğŸ‡­ğŸ‡°|é¦™æ¸¯|HK|Hong|ğŸ‡¹ğŸ‡¼|å°æ¹¾|TW|Taiwan)'
FilterHK: &FilterHK '(?i)(ğŸ‡­ğŸ‡°|é¦™æ¸¯|HK|Hong)'
FilterJP: &FilterJP '(?i)(ğŸ‡¯ğŸ‡µ|æ—¥æœ¬|JP|Japan)'
FilterSG: &FilterSG '(?i)(ğŸ‡¸ğŸ‡¬|æ–°åŠ å¡|SG|Singapore)'
FilterUS: &FilterUS '(?i)(ğŸ‡ºğŸ‡¸|ç¾å›½|US|United States)'
FilterTW: &FilterTW '(?i)(ğŸ‡¹ğŸ‡¼|å°æ¹¾|TW|Taiwan)'
FilterEU: &FilterEU '(?i)(ğŸ‡¬ğŸ‡§|UK|è‹±å›½|ğŸ‡©ğŸ‡ª|DE|å¾·å›½|ğŸ‡«ğŸ‡·|FR|æ³•å›½|ğŸ‡³ğŸ‡±|NL|è·å…°|ğŸ‡®ğŸ‡¹|IT|æ„å¤§åˆ©|ğŸ‡ªğŸ‡¸|ES|è¥¿ç­ç‰™|ğŸ‡¨ğŸ‡­|CH|ç‘å£«|ğŸ‡¸ğŸ‡ª|SE|ç‘å…¸|ğŸ‡³ğŸ‡´|NO|æŒªå¨|ğŸ‡µğŸ‡±|PL|æ³¢å…°|ğŸ‡«ğŸ‡®|FI|èŠ¬å…°)'
# ç­–ç•¥ç»„å‚æ•°é”šç‚¹
Smart: &Smart {type: smart,uselightgbm: true, collectdata: false, strategy: sticky-sessions, interval: 30, tolerance: 30, lazy: true, url: 'http://www.google.com/blank.html', include-all: true}

proxy-groups: 
  - {name: Outside, type: select, proxies: [HK, JP, SG, US, EU, TW,DIRECT]}
  - {name: Microsoft, type: select, proxies: [HK, JP, SG, US, EU, TW,DIRECT]}  
  - {name: Apple, type: select, proxies: [HK, JP, SG, US, EU, TW,DIRECT]}
  - {name: Google, type: select, proxies: [HK, JP, SG, US, EU, TW]}
  - {name: Telegram, type: select, proxies: [HK, JP, SG, US, EU, TW]}
  - {name: OpenAI, type: select, proxies: [JP, US]}
  - {name: Emby, type: select, proxies: [EM,DIRECT]} 
  - {name: HK, <<: *Smart, filter: *FilterHK}
  - {name: TW, <<: *Smart, filter: *FilterTW}
  - {name: SG, <<: *Smart, filter: *FilterSG}
  - {name: JP, <<: *Smart, filter: *FilterJP}
  - {name: US, <<: *Smart, filter: *FilterUS}
  - {name: EU, <<: *Smart, filter: *FilterEU}
  - {name: EM, <<: *Smart, filter: *FilterEM}  


rules:
    - OR,((IP-CIDR,0.0.0.0/32), (IP-CIDR6,::/128)),REJECT
    - OR,((DOMAIN-KEYWORD, adobe),(DOMAIN-SUFFIX,adobe.com),(DOMAIN-SUFFIX,adobe.io),(DOMAIN,local.adguard.org)),REJECT
    - RULE-SET,Private_domain,DIRECT
    - PROCESS-NAME,aria2c.exe,DIRECT
    - DOMAIN,injections.adguard.org,Outside
    - OR,((DOMAIN,media.micu.hk),(DOMAIN,emby.as174.de),(DOMAIN,cf.bili.rip),(DOMAIN,cdn.sexemby.com)),Emby
    - RULE-SET,OpenAI,OpenAI    
    - RULE-SET,Microsoft,Microsoft
    - RULE-SET,Apple_domain,Apple
    - RULE-SET,Telegram,Telegram
    - RULE-SET,Google_domain,Google
    - RULE-SET,CN_domain,DIRECT
    - RULE-SET,Proxy,Outside
      
    - OR,((IP-ASN,62014),(IP-CIDR,91.108.16.0/22),(IP-CIDR,91.108.56.0/22),(IP-CIDR6,2001:b28:f23f::/48)),Telegram
    - OR,((IP-ASN,44907),(IP-ASN,62041),(IP-CIDR,149.154.160.0/20),(IP-CIDR,91.108.4.0/22),(IP-CIDR,91.108.8.0/22),(IP-CIDR6,2001:67c:4e8::/48),(IP-CIDR6,2001:b28:f23c::/48)),EU
    - OR,((IP-ASN,59930),(IP-ASN,21157),(IP-CIDR,91.108.12.0/22),(IP-CIDR6,2001:b28:f23d::/48)),OpenAI
    - RULE-SET,Apple_ip,Apple
    - RULE-SET,Google_ip,Google
    - RULE-SET,CN_ip,DIRECT
    - RULE-SET,Private_ip,DIRECT
    - MATCH,Outside
rule-anchor:
  ip: &ip {type: http, interval: 43200, behavior: ipcidr, format: mrs}
  domain: &domain {type: http, interval: 43200, behavior: domain, format: mrs}
rule-providers:
#åŸŸåç±»
  Private_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/private.mrs"
  CN_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/cn.mrs"
  Microsoft:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/microsoft.mrs"
  Apple_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/apple.mrs"       
  OpenAI:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/openai.mrs"         
  Telegram:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo-lite/geosite/telegram.mrs"
  Proxy:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/geolocation-!cn.mrs"
  Google_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/google.mrs"  
#IPç±»
  Private_ip:
    <<: *ip
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geoip/private.mrs"
  CN_ip:
    <<: *ip
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geoip/cn.mrs"
  Apple_ip:
    <<: *ip
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo-lite/geoip/apple.mrs"
  Google_ip:
    <<: *ip
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geoip/google.mrs"   

