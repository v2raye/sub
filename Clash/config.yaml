mixed-port: 7890
ipv6: true
udp: true
mode: rule
log-level: warning
allow-lan: true
unified-delay: true
tcp-concurrent: true
external-controller: 0.0.0.0:9090
external-ui: ui
external-ui-url: "https://github.com/MetaCubeX/metacubexd/archive/refs/heads/gh-pages.zip"
geox-url:
  asn: "https://mirror.ghproxy.com/https://github.com/xishang0128/geoip/releases/download/latest/GeoLite2-ASN.mmdb"
find-process-mode: strict
global-client-fingerprint: chrome

profile:
  store-selected: true
  store-fake-ip: true

sniffer:
  enable: true
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  skip-domain:
    - "Mijia Cloud"
    - "+.push.apple.com"

tun:
  enable: true
  stack: system
  device: mihomo
  dns-hijack:
    - "any:53"
    - "tcp://any:53"
  auto-route: true
  auto-redirect: true
  auto-detect-interface: true

dns:
  enable: true
  ipv6: true
  prefer-h3: false
  respect-rules: false
# ç”¨äºè§£æ nameserverï¼Œfallback ä»¥åŠå…¶ä»– DNS æœåŠ¡å™¨é…ç½®çš„ï¼ŒDNS æœåŠ¡åŸŸ
# åªèƒ½ä½¿ç”¨çº¯ IP åœ°å€ï¼Œå¯ä½¿ç”¨åŠ å¯† DNS
  default-nameserver:
    - 223.5.5.5
    - system  
  enhanced-mode: fake-ip
  fake-ip-range: 28.0.0.1/8
  fake-ip-filter:
    - "*"
    - "+.lan"
    - "+.local"
    - xbox.*.microsoft.com
    - "*.xboxlive.com"
#ä¸»è¦ DNS é…ç½®ï¼Œå½±å“æ‰€æœ‰ç›´è¿ï¼Œç¡®ä¿ä½¿ç”¨å¯¹å¤§é™†è§£æç²¾å‡†çš„ DNS   
  nameserver:
    - https://xn.h2o.apad.pro/dns-query
    - https://hk.pro.xns.one/RAzoOyGcdkE/dns-query
# ä¸“ç”¨äºèŠ‚ç‚¹åŸŸåè§£æçš„ DNS æœåŠ¡å™¨    
#  proxy-server-nameserver:
#    - https://ipv4.apad.pro/dns-query
#    - https://hk.pro.xns.one/RAzoOyGcdkE/dns-query
# é…ç½®æŸ¥è¯¢åŸŸåä½¿ç”¨çš„ DNS æœåŠ¡å™¨
  nameserver-policy:
    "rule-set:Private_domain,CN_domain":
    - https://xn.h2o.apad.pro/dns-query
    - https://hk.pro.xns.one/RAzoOyGcdkE/dns-query   
    "rule-set:Proxy":
    - https://xn.h2o.apad.pro/dns-query
    - https://hk.pro.xns.one/RAzoOyGcdkE/dns-query
# ç±»ä¼¼äº /etc/hosts, ä»…æ”¯æŒé…ç½®å•ä¸ª IP
#hosts:
# '*.mcdn.bilivideo.cn': 127.0.0.1    
# url é‡Œå¡«å†™è‡ªå·±çš„è®¢é˜…,åç§°ä¸èƒ½é‡å¤
# é”šç‚¹ - èŠ‚ç‚¹è®¢é˜…çš„å‚æ•° [æ¯24å°æ—¶æ›´æ–°ä¸€æ¬¡è®¢é˜…èŠ‚ç‚¹ï¼Œæ¯ 60 ç§’ä¸€æ¬¡å¥åº·æ£€æŸ¥]
NodeParam: &NodeParam {type: http, interval: 86400, health-check: {enable: true, url: 'http://www.google.com/generate_204', interval: 60}}
# é”šç‚¹ - èŠ‚ç‚¹è®¢é˜…
proxy-providers: 
  æˆ‘çš„èŠ‚ç‚¹:
    url: ''
    <<: *NodeParam
    path: './proxy_provider/Providers.yaml'

# é”šç‚¹ - èŠ‚ç‚¹ç­›é€‰ç»„
FilterHK: &FilterHK '^(?=.*((?i)ğŸ‡­ğŸ‡°|é¦™æ¸¯|(\b(HK|Hong)\b))).*$'
FilterJP: &FilterJP '^(?=.*((?i)ğŸ‡¯ğŸ‡µ|æ—¥æœ¬|å·æ—¥|ä¸œäº¬|å¤§é˜ª|æ³‰æ—¥|åŸ¼ç‰|(\b(JP|Japan)\b))).*$'
FilterSG: &FilterSG '^(?=.*((?i)ğŸ‡¸ğŸ‡¬|æ–°åŠ å¡|ç‹®|(\b(SG|Singapore)\b))).*$'
FilterUS: &FilterUS '^(?=.*((?i)ğŸ‡ºğŸ‡¸|ç¾å›½|æ³¢ç‰¹å…°|è¾¾æ‹‰æ–¯|ä¿„å‹’å†ˆ|å‡¤å‡°åŸ|è´¹åˆ©è’™|ç¡…è°·|æ‹‰æ–¯ç»´åŠ æ–¯|æ´›æ‰çŸ¶|åœ£ä½•å¡|åœ£å…‹æ‹‰æ‹‰|è¥¿é›…å›¾|èŠåŠ å“¥|(\b(US|United States)\b))).*$'
FilterTW: &FilterTW '^(?=.*((?i)ğŸ‡¹ğŸ‡¼|å°æ¹¾|(\b(TW|Taiwan)\b))).*$'
FilterEU: &FilterEU '^(?!.*(ğŸ‡ºğŸ‡¸|US|us|ç¾å›½|ç¾|United States|ğŸ‡¸ğŸ‡¬|SG|sg|æ–°åŠ å¡|ç‹®|Singapore|ğŸ‡¯ğŸ‡µ|JP|jp|æ—¥æœ¬|æ—¥|Japan|ğŸ‡¹ğŸ‡¼|TW|tw|å°æ¹¾|è‡ºç£|å°|Taiwan|ğŸ‡­ğŸ‡°|HK|hk|é¦™æ¸¯|æ¸¯)).*$'
FilterAll: &FilterAll '^(?=.*(.)).*$'
# ç­–ç•¥ç»„å‚æ•°é”šç‚¹
# é”šç‚¹ - è´Ÿè½½å‡è¡¡å‚æ•° [æ¯ 6 ç§’ä¸€æ¬¡æƒ°æ€§å¥åº·æ£€æŸ¥ï¼Œæ—¶å»¶è¶…è¿‡ 2 ç§’åˆ¤å®šä¸ºå¤±è´¥ï¼Œå¤±è´¥ 3 æ¬¡åˆ™è‡ªåŠ¨è§¦å‘å¥åº·æ£€æŸ¥]
Select: &Select {type: select, url: 'http://connectivitycheck.platform.hicloud.com/generate_204', disable-udp: false, hidden: false, include-all: true}
# ç­–ç•¥ç»„
proxy-groups: 
  - {name: Outside, type: select, proxies: [é¦™æ¸¯èŠ‚ç‚¹, æ—¥æœ¬èŠ‚ç‚¹, æ–°åŠ å¡èŠ‚ç‚¹, ç¾å›½èŠ‚ç‚¹, æ¬§ç›ŸèŠ‚ç‚¹, å°æ¹¾èŠ‚ç‚¹,DIRECT]}
  - {name: YouTube, type: select, proxies: [é¦™æ¸¯èŠ‚ç‚¹, æ—¥æœ¬èŠ‚ç‚¹, æ–°åŠ å¡èŠ‚ç‚¹, ç¾å›½èŠ‚ç‚¹, æ¬§ç›ŸèŠ‚ç‚¹, å°æ¹¾èŠ‚ç‚¹]}
  - {name: Google, type: select, proxies: [é¦™æ¸¯èŠ‚ç‚¹, æ—¥æœ¬èŠ‚ç‚¹, æ–°åŠ å¡èŠ‚ç‚¹, ç¾å›½èŠ‚ç‚¹, æ¬§ç›ŸèŠ‚ç‚¹, å°æ¹¾èŠ‚ç‚¹]}
  - {name: OpenAI, type: select, proxies: [é¦™æ¸¯èŠ‚ç‚¹, æ—¥æœ¬èŠ‚ç‚¹, æ–°åŠ å¡èŠ‚ç‚¹, ç¾å›½èŠ‚ç‚¹, æ¬§ç›ŸèŠ‚ç‚¹, å°æ¹¾èŠ‚ç‚¹]}
  - {name: Apple, type: select, proxies: [é¦™æ¸¯èŠ‚ç‚¹, æ—¥æœ¬èŠ‚ç‚¹, æ–°åŠ å¡èŠ‚ç‚¹, ç¾å›½èŠ‚ç‚¹, æ¬§ç›ŸèŠ‚ç‚¹, å°æ¹¾èŠ‚ç‚¹,DIRECT]} 
  - {name: Telegram, type: select, proxies: [é¦™æ¸¯èŠ‚ç‚¹, æ—¥æœ¬èŠ‚ç‚¹, æ–°åŠ å¡èŠ‚ç‚¹, ç¾å›½èŠ‚ç‚¹, æ¬§ç›ŸèŠ‚ç‚¹, å°æ¹¾èŠ‚ç‚¹]}
  - {name: Microsoft, type: select, proxies: [é¦™æ¸¯èŠ‚ç‚¹, æ—¥æœ¬èŠ‚ç‚¹, æ–°åŠ å¡èŠ‚ç‚¹, ç¾å›½èŠ‚ç‚¹, æ¬§ç›ŸèŠ‚ç‚¹, å°æ¹¾èŠ‚ç‚¹,DIRECT]}

  - {name: é¦™æ¸¯èŠ‚ç‚¹, <<: *Select, filter: *FilterHK}
  - {name: å°æ¹¾èŠ‚ç‚¹, <<: *Select, filter: *FilterTW}
  - {name: æ—¥æœ¬èŠ‚ç‚¹, <<: *Select, filter: *FilterJP}
  - {name: æ–°åŠ å¡èŠ‚ç‚¹, <<: *Select, filter: *FilterSG}
  - {name: ç¾å›½èŠ‚ç‚¹, <<: *Select, filter: *FilterUS}
  - {name: æ¬§ç›ŸèŠ‚ç‚¹, <<: *Select, filter: *FilterEU}
rules:
    - DOMAIN-SUFFIX,mcdn.bilivideo.cn,REJECT
    - DOMAIN-SUFFIX,szbdyd.com,REJECT
    - AND,((DOMAIN-KEYWORD,pcdn),(DOMAIN-SUFFIX,biliapi.net)),REJECT
    - DOMAIN,local.adguard.org,REJECT
    - DOMAIN,injections.adguard.org,Outside
    - AND,(AND,(DST-PORT,443),(NETWORK,UDP)),(NOT,((RULE-SET,CN_ip))),REJECT
    - RULE-SET,Private_domain,DIRECT
    - RULE-SET,Microsoft,Microsoft
    - RULE-SET,OpenAI,OpenAI
    - RULE-SET,Google_domain,Google
    - RULE-SET,Apple_domain,Apple
    - RULE-SET,Telegram,Telegram
    - RULE-SET,CN_domain,DIRECT
    - RULE-SET,Proxy,Outside
      
    - RULE-SET,Private_ip,DIRECT,no-resolve
    - OR,((IP-ASN,62014),(IP-CIDR,91.108.16.0/22),(IP-CIDR,91.108.56.0/22),(IP-CIDR6,2001:b28:f23f::/48)),Telegram
    - OR,((IP-ASN,44907),(IP-ASN,62041),(IP-CIDR,149.154.160.0/20),(IP-CIDR,91.108.4.0/22),(IP-CIDR,91.108.8.0/22),(IP-CIDR6,2001:67c:4e8::/48),(IP-CIDR6,2001:b28:f23c::/48)),æ¬§ç›ŸèŠ‚ç‚¹
    - OR,((IP-ASN,59930),(IP-ASN,21157),(IP-CIDR,91.108.12.0/22),(IP-CIDR6,2001:b28:f23d::/48)),OpenAI
    - RULE-SET,Apple_ip,Apple
    - RULE-SET,Google_ip,Google
    - RULE-SET,CN_ip,DIRECT
    - MATCH,Outside
rule-anchor:
  ip: &ip {type: http, interval: 43200, behavior: ipcidr, format: mrs}
  domain: &domain {type: http, interval: 43200, behavior: domain, format: mrs}
rule-providers:
#åŸŸåç±»
  Private_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/private.mrs"
  CN_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/cn.mrs"
  Microsoft:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/microsoft.mrs"
  Apple_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/apple.mrs"       
  OpenAI:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/openai.mrs"         
  Google_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/google.mrs"
  Telegram:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo-lite/geosite/telegram.mrs"
  Proxy:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/geolocation-!cn.mrs"
#IPç±»
  Private_ip:
    <<: *ip
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geoip/private.mrs"
  CN_ip:
    <<: *ip
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geoip/cn.mrs"
  Google_ip:
    <<: *ip
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geoip/google.mrs"
  Apple_ip:
    <<: *ip
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo-lite/geoip/apple.mrs"

